{% extends 'base.html.twig' %}

{% block title %}{{ meta.title }} - Pastebin{% endblock %}

{% block extra_styles %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
{% if displayMode ends with '-wide' %}
<style>
.container {
    max-width: 100%;
}
</style>
{% endif %}
{% endblock %}

{% block content %}
<header>
    <div>
        <h1>{% if not meta.public %}ðŸ”’ {% endif %}{{ meta.title }}</h1>
    </div>
    <div class="nav">
        <a href="{{ basePath|default('../..') }}/" class="button">Home</a>
        <a href="{{ basePath|default('../..') }}/notes/{{ paste.getId() }}/edit" class="button secondary">Edit</a>
    </div>
</header>

{% if meta.description %}
<div class="description">
    {{ meta.description }}
</div>
{% endif %}

{% for file in files %}
    {% if file.meta.unwrapped %}
        {# Unwrapped file: just show description + content (no wrapper/header) #}
        {% if file.meta.description %}
        <div class="description">
            {{ file.meta.description }}
        </div>
        {% endif %}

        {{ file.renderedContent|raw }}
    {% else %}
        {# Wrapped file: show full file section with header #}
        <div class="file-section {% if file.meta.collapsed %}collapsed{% endif %}" data-collapsed="{{ file.meta.collapsed ? 'true' : 'false' }}">
            <div class="file-header" onclick="toggleFileSection(this)">
                <div class="file-header-left">
                    <span class="collapse-icon">{% if file.meta.collapsed %}â–ºï¸Ž{% else %}â–¼{% endif %}</span>
                    <h2>{{ file.meta.displayName|default(file.filename) }}</h2>
                </div>
                <div class="file-meta">
                    {% if file.meta.type and file.meta.type not in ['image', 'file', 'file-link', 'link'] %}
                        Type: {{ file.meta.type }}
                        {% if file.meta.render not in ['file-link'] %} | {% endif %}
                    {% endif %}
                    {% if file.meta.render not in ['file-link'] %}
                        <a href="./files/{{ file.filename|url_encode }}" onclick="event.stopPropagation();">View</a>
                    {% endif %}
                </div>
            </div>

            {% if file.meta.collapsedDescription %}
            <div class="file-collapsed-description">
                <small><em>{{ file.meta.collapsedDescription }}</em></small>
            </div>
            {% endif %}

            <div class="file-body">
                {% if file.meta.description %}
                <p class="file-description">{{ file.meta.description }}</p>
                {% endif %}

                <div class="file-content">
                    {{ file.renderedContent|raw }}
                </div>
            </div>
        </div>
    {% endif %}
{% endfor %}

<footer>
    {% if meta.author %}
        by {{ meta.author }} |
    {% endif %}
    Created: {{ meta.createdAt|date('Y-m-d H:i:s') }}
    {% if meta.updatedAt and meta.updatedAt != meta.createdAt %}
        | Updated: {{ meta.updatedAt|date('Y-m-d H:i:s') }}
    {% endif %}
</footer>
{% endblock %}

{% block extra_scripts %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Only highlight code blocks with language-* class
        document.querySelectorAll('pre code[class*="language-"]').forEach(function(block) {
            hljs.highlightElement(block);
        });
    });

    function toggleFileSection(header) {
        const section = header.closest('.file-section');
        const icon = section.querySelector('.collapse-icon');

        if (section.classList.contains('collapsed')) {
            // Expand
            section.classList.remove('collapsed');
            icon.textContent = 'â–¼';
        } else {
            // Collapse
            section.classList.add('collapsed');
            icon.textContent = 'â–ºï¸Ž';
        }
    }
</script>
{% endblock %}
